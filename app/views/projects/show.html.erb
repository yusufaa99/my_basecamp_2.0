<h1><%= @project.title %></h1> 
<p><strong>Description:</strong> <%= @project.description %></p>
<p><strong>Deadline:</strong> <%= @project.deadline.strftime("%B %d, %Y") if @project.deadline %></p>
<p><strong>Created by:</strong> <%= @project.creator.email %></p>

<hr>
<h2>Project Members</h2>
<ul>
  <% @project.project_memberships.each do |membership| %>
    <li>
      <%= membership.user.email %> (<%= membership.role %>)
    </li>
  <% end %>
</ul>

<hr>
<h2>Attachments</h2>
<% if @project.attachments.any? %>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>File URL</th>
        <th>Format</th>
        <th>Uploaded By</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @project.attachments.each do |attachment| %>
        <tr>
          <td><%= attachment.file_url %></td>
          <td><%= attachment.file_format %></td>
          <td><%= attachment.user.email %></td>
          <td>
          <%= button_to "Delete", project_attachment_path(@project, attachment), 
                            method: :delete, data: { confirm: "Are you sure?" }, 
                            class: "btn btn-sm btn-danger" %>

          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No attachments yet.</p>
<% end %>

<hr>
<h3>Add a New Attachment</h3>
<%= form_with model: [@project, Attachment.new], local: true do |f| %>
  <div class="mb-3">
    <%= f.label :file_url, "File URL", class: "form-label" %>
    <%= f.text_field :file_url, class: "form-control", placeholder: "Enter file URL or path" %>
  </div>
  <div class="mb-3">
    <%= f.label :file_format, "File Format", class: "form-label" %>
    <%= f.select :file_format, 
          options_for_select([["PNG", "png"], ["JPG", "jpg"], ["PDF", "pdf"], ["TXT", "txt"]]),
          {}, class: "form-select" %>
  </div>
  <div class="mb-3">
    <%= f.submit "Add Attachment", class: "btn btn-primary" %>
  </div>
<% end %>

<hr>
<h2>Threads</h2>

<% if @project.project_threads.any? %>
  <ul>
    <% @project.project_threads.each do |thread| %>
      <li>
        <strong><%= thread.title %></strong> (Created by: <%= thread.user.email %>)

        <% if current_user == @project.creator %>
          <%= link_to "Edit", edit_project_project_thread_path(@project, thread), class: "btn btn-sm btn-warning" %>
          <%= button_to "Delete", project_project_thread_path(@project, thread), 
                method: :delete, data: { confirm: "Are you sure?" }, 
                class: "btn btn-sm btn-danger" %>
        <% end %>

        <!-- Display Messages -->
        <ul>
          <% thread.messages.each do |message| %>
            <li>
              <p><%= message.content %> - <small>By <%= message.user.email %></small></p>

              <% if message.user == current_user %>
                <%= link_to "Edit", edit_project_project_thread_message_path(@project, thread, message), class: "btn btn-sm btn-secondary" %>
                <%= button_to "Delete", project_project_thread_message_path(@project, thread, message), 
                      method: :delete, data: { confirm: "Are you sure?" }, 
                      class: "btn btn-sm btn-danger" %>
              <% end %>
            </li>
          <% end %>
        </ul>

        <!-- Message Form -->
        <h4>Post a Message</h4>
        <%= form_with model: [@project, thread, Message.new], local: true do |f| %>
          <div class="mb-3">
            <%= f.text_area :content, class: "form-control", placeholder: "Write a message..." %>
          </div>
          <%= f.submit "Post", class: "btn btn-primary" %>
        <% end %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>No threads yet.</p>
<% end %>


<% if current_user == @project.creator %>
  <%= link_to "Create Thread", new_project_project_thread_path(@project), class: "btn btn-primary" %>
<% end %>


<hr>
<%= link_to "Invite Member", new_project_project_invitation_path(@project), class: "btn btn-primary" %>
<%= link_to "Edit Project", edit_project_path(@project), class: "btn btn-secondary" %>
<%= link_to "Back to Projects", projects_path, class: "btn btn-secondary" %>
