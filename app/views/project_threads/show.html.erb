<h1><%= @project_thread.title %></h1>
<p><%= @project_thread.description %></p>

<h3>Messages</h3>
<ul>
  <% @project_thread.messages.each do |message| %>
    <li>
      <strong><%= message.user.email %></strong>: <%= message.content %>

      <!-- Only allow the message owner or an admin to delete -->
      <% if message.user == current_user || @project_thread.project.project_memberships.find_by(user: current_user, role: "admin") %>
        <%= button_to "Delete", project_project_thread_message_path(@project_thread.project, @project_thread, message), 
              method: :delete, data: { confirm: "Are you sure you want to delete this message?" }, 
              class: "btn btn-sm btn-danger" %>
      <% end %>
    </li>
  <% end %>
</ul>

<!-- Messages Container -->
<div id="messages">
  <ul>
    <%= render @project_thread.messages if @project_thread.messages.any? %>
  </ul>
</div>

<!-- Form to Post a New Message -->
<h4>Post a Message</h4>
<%= form_with model: [@project_thread.project, @project_thread, Message.new], local: true do |f| %>
  <div class="mb-3">
    <%= f.text_area :content, class: "form-control", placeholder: "Write a message..." %>
  </div>
  <%= f.submit "Post", class: "btn btn-primary" %>
<% end %>

<hr>

<!-- Back to Project -->
<%= link_to "Back to Project", project_path(@project_thread.project), class: "btn btn-secondary" %>
